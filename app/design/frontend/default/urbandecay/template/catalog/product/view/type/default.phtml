<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2014 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php /* @var $this Mage_Catalog_Block_Product_View_Abstract */?>
<?php
$_product = $this->getProduct();
$_attributes = Mage::helper('core')->decorateArray($this->getAllowAttributes());
?>

<?php echo $this->getChildHtml('product_type_data_extra') ?>
<?php echo $this->getPriceHtml($_product) ?>

<div class="product-select-options">
<?php if ($_product->isSaleable() && count($_attributes)):?>
        <?php foreach($_attributes as $_attribute): ?>
            <div class="input-box">
                <select name="super_attribute[<?php echo $_attribute->getAttributeId() ?>]" id="attribute<?php echo $_attribute->getAttributeId() ?>" class="required-entry super-attribute-select">
                    <option><?php echo $this->__('Choose an Option...') ?></option>
                </select>
            </div>
        <?php endforeach; ?>
    <script type="text/javascript">
        var spConfig = new Product.Config(<?php echo $this->getJsonConfig() ?>);
    </script>
<?php endif;?>
    <?php $stocks = $_product->getStockItem()->getQty(); ?>
    <?php if(!$_product->isGrouped()): ?>
        <div class="select">
            <div id="slct_arrow" class="slct"></div>
            <a href="#" class="slct">1</a>
            <ul class="slct_drop">
                <li class="first_li">1</li>
                <?php if ($stocks < 5): ?>
                    <?php for($i = 2; $i <= $stocks; $i++): ?>
                        <li><?php echo $i; ?></li>
                    <?php endfor; ?>
                <?php else: ?>
                    <?php for($i = 2; $i <= 5; $i++): ?>
                        <li><?php echo $i; ?></li>
                    <?php endfor; ?>
                <?php endif; ?>
            </ul>
            <input type="hidden" name="qty" id="qty" maxlength="12" value="<?php echo $this->getProductDefaultQty() * 1 ?>" class="input-text qty" />
        </div>
    <?php endif; ?>
</div>

<?php if ($this->displayProductStockStatus()): ?>
    <?php if ($_product->isAvailable()): ?>
        <p class="availability in-stock"><span><?php echo $this->__('In Stock') ?></span></p>
    <?php else: ?>
        <p class="availability out-of-stock"><span><?php echo $this->__('Out of Stock') ?></span></p>
    <?php endif; ?>
<?php endif; ?>


<script type="text/javascript">
    var $j = jQuery.noConflict();

    $j(document).ready(function(){
        $j('.slct').click(function(){
            var dropBlock = $j(this).parent().find('.slct_drop');

            if( dropBlock.is(':hidden') ) {
                dropBlock.slideDown();

                $j(this).addClass('active');
                $j('#slct_arrow').addClass('active_arrow');

                $j('.slct_drop').find('li').click(function(){

                    var selectResult = $j(this).html();

                    $j(this).parent().parent().find('#qty').val(selectResult);

                    $j('.slct').removeClass('active').html(selectResult);
                    $j('#slct_arrow').removeClass('active_arrow');

                    dropBlock.slideUp();
                });
            } else {
                $j(this).removeClass('active');
                $j('#slct_arrow').removeClass('active_arrow');
                dropBlock.slideUp();
            }
            return false;
        });

    });
</script>